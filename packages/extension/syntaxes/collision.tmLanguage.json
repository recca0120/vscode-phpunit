{
    "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
    "name": "PHPUnit",
    "patterns": [
        { "comment": "--- Dot-progress line ---" },
        {
            "comment": "Dot-progress line: only match lines composed of [.FEISR] with optional counter",
            "begin": "^(?=[.FEISR]{2,})",
            "end": "$",
            "patterns": [
                {
                    "comment": "F and E ‚Üí red",
                    "match": "[FE]",
                    "name": "invalid.phpunit"
                },
                {
                    "comment": "R, I, S ‚Üí yellow",
                    "match": "[RIS]",
                    "name": "markup.deleted.phpunit"
                },
                {
                    "comment": "Counter (62 / 62 (100%)) ‚Üí gray",
                    "match": "\\d+\\s*/\\s*\\d+\\s*\\(\\d+%\\)",
                    "name": "comment.phpunit"
                }
            ]
        },

        { "comment": "--- Test result lines ---" },
        {
            "comment": "Passed test line ‚Üí green",
            "match": "^\\s+‚úÖ\\s+.+\\d+\\s*ms",
            "name": "markup.inserted.phpunit"
        },
        {
            "comment": "Failed test line ‚Üí red",
            "match": "^\\s+‚ùå\\s+.+\\d+\\s*ms",
            "name": "invalid.phpunit"
        },
        {
            "comment": "Ignored/skipped test line ‚Üí yellow",
            "match": "^\\s+‚ûñ\\s+.+",
            "name": "markup.deleted.phpunit"
        },
        {
            "comment": "Printed output block (dd/dump) ‚Üí VarDumper highlighting",
            "begin": "^üü®\\s+",
            "end": "^(?!\\s+[\\[\\]{}\"\\d+#@&~*‚Ä¶()+\\-]|\\s+\\))",
            "name": "meta.embedded.vardumper.phpunit",
            "patterns": [{ "include": "source.vardumper" }]
        },

        { "comment": "--- Error details ---" },
        {
            "comment": "Numbered error title ‚Üí red (e.g. '1) Tests\\Foo::method')",
            "match": "^\\d+\\)\\s+\\S+",
            "name": "invalid.phpunit"
        },
        {
            "comment": "FAILED error title ‚Üí icon+FAILED red, rest default",
            "match": "^(\\s+‚ùå\\s+FAILED)(\\s+.+)",
            "captures": {
                "1": { "name": "invalid.phpunit" }
            }
        },
        {
            "comment": "Error line without indent ‚Üí red",
            "match": "^‚ùå\\s+.+",
            "name": "invalid.phpunit"
        },

        { "comment": "--- Source code display ---" },
        {
            "comment": "Arrow source line ‚Üí arrow+number red, ‚ñï gray, code PHP",
            "match": "(‚ûú\\s+\\d+\\s+)(‚ñï)(\\s?.*$)",
            "captures": {
                "1": { "name": "invalid.phpunit" },
                "2": { "name": "comment.phpunit" },
                "3": {
                    "name": "meta.embedded.php.phpunit",
                    "patterns": [{ "include": "source.php" }]
                }
            }
        },
        {
            "comment": "Source line ‚Üí line number gray, ‚ñï gray, code PHP",
            "match": "(\\s+\\d+\\s+)(‚ñï)(\\s?.*$)",
            "captures": {
                "1": { "name": "comment.phpunit" },
                "2": { "name": "comment.phpunit" },
                "3": {
                    "name": "meta.embedded.php.phpunit",
                    "patterns": [{ "include": "source.php" }]
                }
            }
        },

        { "comment": "--- File references ---" },
        {
            "comment": "File path links (with optional 'at' prefix)",
            "match": "\\S+\\.php:\\d+",
            "name": "string.link.phpunit"
        },

        { "comment": "--- Diff ---" },
        {
            "comment": "Diff header lines ‚Üí gray",
            "match": "^(---|\\+\\+\\+|@@)\\s.*",
            "name": "comment.phpunit"
        },
        {
            "comment": "Diff removed line ‚Üí red",
            "match": "^-.+",
            "name": "invalid.phpunit"
        },
        {
            "comment": "Diff added line ‚Üí green",
            "match": "^\\+.+",
            "name": "markup.inserted.phpunit"
        },

        { "comment": "--- Summary statistics ---" },
        {
            "comment": "Pest summary: N failed ‚Üí red",
            "match": "\\d+\\s+failed",
            "name": "invalid.phpunit"
        },
        {
            "comment": "Pest summary: N passed ‚Üí green",
            "match": "\\d+\\s+passed",
            "name": "markup.inserted.phpunit"
        },
        {
            "comment": "Pest summary: N skipped ‚Üí yellow",
            "match": "\\d+\\s+skipped",
            "name": "markup.deleted.phpunit"
        },
        {
            "comment": "PHPUnit summary: Errors/Failures ‚Üí red",
            "match": "(Errors|Failures):\\s+\\d+",
            "name": "invalid.phpunit"
        },
        {
            "comment": "PHPUnit summary: Skipped/Incomplete/Risky/Warnings/Deprecations ‚Üí yellow",
            "match": "(Skipped|Incomplete|Risky|Warnings|PHPUnit Deprecations):\\s+\\d+",
            "name": "markup.deleted.phpunit"
        },

        { "comment": "--- Metadata ---" },
        {
            "comment": "Info lines ‚Üí gray",
            "match": "^(Time|Duration|Runtime|Configuration|Processes):.*",
            "name": "comment.phpunit"
        },
        {
            "comment": "Duration at end of line ‚Üí gray",
            "match": "\\d+\\s*ms$",
            "name": "comment.phpunit"
        }
    ],
    "scopeName": "source.phpunit"
}
